name: testes-migracao-pipeline
on:
  push
jobs:
  github-testes-migracao-pipeline:
    runs-on: ubuntu-latest
    steps:
      - name: Alterando timestamp gmud e efetuando sleep
          uses: nick-fields/retry@v2
          with:
            timeout_minutes: 300
            max_attempts: 3
        run: |
          echo -e "#### Convertendo para TZ America/Sao_Paulo ####";

          start_date="2022-11-04 01:00:00"
          echo -e "Data da mudança na gmud: $start_date"

          convert_to_date=$(date -d "$start_date")
          echo -e "convert_to_date --> $convert_to_date"

          brasilian_time="$(TZ=America/Sao_Paulo date -d "$convert_to_date" +'%m/%d/%Y %H:%M')"
          echo -e "brasilian_time --> $brasilian_time"

          echo -e "\n#### get seconds ####"
          convert_seconds_start_date=$(date -d "$brasilian_time" +%s)
          echo -e "convert_seconds_start_date --> $convert_seconds_start_date"

          echo -e "\n#### sleep ####"
          export TZ=America/Sao_Paulo
          date
          current_epoch=$(date +%s)
          sleep_seconds=$(($convert_seconds_start_date - $current_epoch))
          echo "sleep_seconds --> $sleep_seconds"
          echo "sleep_gmud=$sleep_seconds" >> $GITHUB_ENV

      - name: Sleep time
        continue-on-error: true
        run: |
          echo " ${{ env.sleep_gmud }} 10 horas são 36000 segundos"
          if [[ ${{ env.sleep_gmud }} -gt 0 ]]; then
            echo "info: maior que 0"
            sleep ${{ env.sleep_gmud }} & wait $!
            exit 0
          fi

